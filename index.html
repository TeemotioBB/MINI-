<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spark Mini App - Premium Match</title>
 
  <!-- Telegram Web App -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
 
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
 
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
 
  <!-- CSS Customizado -->
  <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="w-full max-w-[370px] p-4">
        <div class="glass-card p-4 relative">
            <!-- Header -->
            <div class="flex justify-between items-center mb-4 px-2">
                <div class="flex items-center gap-2 font-black text-2xl text-gray-800 tracking-tighter">
                    <i class="fa-solid fa-fire-flame-curved text-orange-500"></i> SPARK
                </div>
                <button class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 text-gray-500">
                    <i class="fa-solid fa-sliders"></i>
                </button>
            </div>
            <!-- Profile Card (visÃ­vel quando tem perfis) -->
            <div id="profile-card-area">
                <div class="relative">
                    <img id="profile-image" src="" class="profile-img mb-4" alt="Perfil">
                    <div id="verified-badge" class="absolute top-4 left-4 bg-white/90 backdrop-blur-md px-3 py-1 rounded-full flex items-center gap-1">
                        <i class="fa-solid fa-circle-check text-blue-500 text-xs"></i>
                        <span class="text-[10px] font-bold text-gray-700 uppercase">Verificado</span>
                    </div>
                </div>
                <!-- Profile Info -->
                <div class="px-2 mb-6 text-center">
                    <h2 id="profile-name" class="text-2xl font-extrabold text-gray-900">Carregando...</h2>
                    <p id="profile-bio" class="text-gray-500 text-sm mt-1"></p>
                </div>
                <!-- Action Buttons -->
                <div id="action-buttons" class="flex justify-center items-center gap-4 px-2 pb-2">
                    <button id="btn-star" class="btn-action bg-blue-100 text-blue-500">
                        <i class="fa-solid fa-star text-lg"></i>
                    </button>
                    <button id="btn-dislike" class="btn-action bg-white text-red-500 border border-red-50 text-2xl">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                    <button id="btn-like" class="btn-action bg-gradient-to-br from-green-400 to-emerald-500 text-white text-2xl">
                        <i class="fa-solid fa-heart"></i>
                    </button>
                    <div class="relative">
                        <button id="btn-boost" class="btn-action bg-gradient-to-tr from-purple-600 to-indigo-600 text-white">
                            <i class="fa-solid fa-bolt-lightning text-lg"></i>
                        </button>
                        <span class="absolute -bottom-5 left-1/2 -translate-x-1/2 text-[8px] font-black text-purple-600 uppercase whitespace-nowrap">Boost 1h</span>
                    </div>
                </div>
            </div>
            <!-- Tela de Sem Perfis (escondida por padrÃ£o) -->
            <div id="no-profiles-area" class="hidden">
                <div class="text-center py-8">
                    <div class="w-32 h-32 mx-auto mb-6 bg-gradient-to-br from-orange-100 to-pink-100 rounded-full flex items-center justify-center animate-pulse">
                        <i class="fa-solid fa-heart-crack text-5xl text-orange-400"></i>
                    </div>
                    <h2 class="text-2xl font-extrabold text-gray-800 mb-2">Por enquanto Ã© sÃ³! ğŸ’«</h2>
                    <p class="text-gray-500 text-sm mb-6 px-4">
                        NÃ£o hÃ¡ mais perfis na sua regiÃ£o.<br>Volte mais tarde para conhecer novas pessoas!
                    </p>
                    <div class="flex flex-col gap-3 px-4">
                        <button onclick="location.reload()" class="w-full bg-gradient-to-r from-orange-500 to-pink-500 text-white font-bold py-3 rounded-2xl shadow-lg hover:shadow-xl transition-all">
                            <i class="fa-solid fa-arrows-rotate mr-2"></i> Atualizar
                        </button>
                        <a href="likes.html" class="w-full bg-gray-100 text-gray-700 font-bold py-3 rounded-2xl text-center hover:bg-gray-200 transition-all">
                            <i class="fa-solid fa-star mr-2 text-orange-500"></i> Ver quem curtiu vocÃª
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Bottom Navigation -->
        <div class="flex justify-around items-center mt-8 bg-white/80 backdrop-blur-xl p-3 rounded-3xl shadow-lg border border-white">
            <a href="index.html" class="flex flex-col items-center text-orange-500">
                <i class="fa-solid fa-layer-group text-xl"></i>
                <span class="text-[9px] font-bold mt-1 uppercase">Explorar</span>
            </a>
            <a href="likes.html" class="flex flex-col items-center text-gray-400 relative">
                <i class="fa-solid fa-star text-xl"></i>
                <span id="likes-badge" class="hidden absolute -top-1 -right-2 bg-pink-500 text-white text-[9px] font-bold w-4 h-4 flex items-center justify-center rounded-full border-2 border-white">0</span>
                <span class="text-[9px] font-bold mt-1 uppercase">Likes</span>
            </a>
            <a href="chat.html" class="flex flex-col items-center text-gray-400">
                <i class="fa-solid fa-comment-dots text-xl"></i>
                <span class="text-[9px] font-bold mt-1 uppercase">Chat</span>
            </a>
            <a href="perfil.html" class="flex flex-col items-center text-gray-400">
                <i class="fa-solid fa-circle-user text-xl"></i>
                <span class="text-[9px] font-bold mt-1 uppercase">Perfil</span>
            </a>
        </div>
    </div>
    <!-- âš¡ ORDEM IMPORTANTE DOS SCRIPTS! -->
    <script src="profiles.js"></script>
    <script src="config.js"></script>
    <script src="vip.js"></script>
    <script src="match.js"></script>
    <script src="app.js"></script>

<!-- ========== BOTÃƒO SECRETO DE DEBUG - SÃ“ PARA USUÃRIOS DE TESTE ========== -->
<script>
// âœ… CORRIGIDO - Verifica se Ã© um dos usuÃ¡rios de teste (com parseInt!)
function isTestUser() {
    const testUsers = [1293602874, 8542013089];
   
    // Tenta pegar do Telegram
    if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe?.user?.id) {
        const telegramId = parseInt(window.Telegram.WebApp.initDataUnsafe.user.id);  // âœ… parseInt!
        console.log('ğŸ” Verificando ID:', telegramId, 'Ã‰ teste?', testUsers.includes(telegramId));
        return testUsers.includes(telegramId);
    }
   
    // Tenta pegar do localStorage
    const testId = localStorage.getItem('testTelegramId');
    if (testId) {
        return testUsers.includes(parseInt(testId));
    }
   
    return false;
}

// SÃ³ mostra o botÃ£o se for usuÃ¡rio de teste
if (isTestUser()) {
    console.log('ğŸ§ª UsuÃ¡rio de teste detectado! BotÃ£o de debug ativado.');
   
    // Cria o botÃ£o
    const debugBtn = document.createElement('button');
    debugBtn.innerHTML = 'ğŸ”„';
    debugBtn.title = 'Limpar perfis vistos (sÃ³ para teste)';
    debugBtn.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: 3px solid white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        font-size: 24px;
        cursor: pointer;
        z-index: 9999;
        opacity: 0.7;
        transition: all 0.3s ease;
    `;
   
    // Hover effect
    debugBtn.addEventListener('mouseenter', () => {
        debugBtn.style.opacity = '1';
        debugBtn.style.transform = 'scale(1.1)';
    });
   
    debugBtn.addEventListener('mouseleave', () => {
        debugBtn.style.opacity = '0.7';
        debugBtn.style.transform = 'scale(1)';
    });
   
    // FunÃ§Ã£o para resetar likes via API
    async function resetLikesBetweenTests() {
        console.log('ğŸ§¹ Resetando likes entre usuÃ¡rios de teste via API...');
        
        try {
            const telegramId1 = '1293602874';
            const telegramId2 = '8542013089';
            const adminSecret = 'minha_chave_super_secreta_admin_2024';

            const response = await fetch('https://mini-production-cf60.up.railway.app/api/admin/reset-likes-between-users', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    secret: adminSecret,
                    telegram_id1: telegramId1,
                    telegram_id2: telegramId2
                })
            });

            if (!response.ok) throw new Error('Erro na API');
            const data = await response.json();
            console.log('âœ… Likes resetados:', data);

            // Toast de sucesso
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 left-1/2 -translate-x-1/2 bg-blue-500 text-white px-6 py-3 rounded-full shadow-lg z-[9999] text-sm font-bold';
            toast.textContent = 'âœ… Likes mÃºtuos resetados no banco!';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        } catch (error) {
            console.error('âŒ Erro ao resetar likes:', error);
        }
    }
   
    // FunÃ§Ã£o de limpar
    debugBtn.addEventListener('click', async () => {
        console.log('ğŸ§¹ Limpando TUDO (perfis vistos + limites + likes)...');
       
        // 1. Limpa perfis vistos do FRONTEND
        localStorage.removeItem('sparkSeenProfiles');
        console.log('âœ… Perfis vistos limpos do localStorage');
       
        // 2. Limpa limites VIP do FRONTEND
        localStorage.removeItem('sparkDailyLimits');
        localStorage.removeItem('sparkWeeklyLimits');
        console.log('âœ… Limites VIP limpos do localStorage');
       
        // 3. RESETA LIMITES NO BACKEND
        try {
            const response = await fetch('https://mini-production-cf60.up.railway.app/api/debug/reset-limits-only');
            if (response.ok) {
                const data = await response.json();
                console.log('âœ… Limites resetados no backend:', data);
            }
        } catch (error) {
            console.warn('âš ï¸ Erro ao resetar backend (continuando mesmo assim):', error);
        }
       
        // 4. RESETA LIKES MÃšTUOS NO BANCO VIA API
        await resetLikesBetweenTests();
       
        // AnimaÃ§Ã£o de sucesso
        debugBtn.innerHTML = 'âœ…';
        debugBtn.style.background = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
       
        // 5. Mensagem de sucesso
        const toast = document.createElement('div');
        toast.className = 'fixed top-4 left-1/2 -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-full shadow-lg z-[60] text-sm font-bold';
        toast.textContent = 'âœ… TUDO limpo! Perfis + Limites + Likes resetados!';
        document.body.appendChild(toast);
       
        console.log('âœ… Perfis vistos limpos!');
        console.log('âœ… Limites resetados!');
        console.log('âœ… Likes resetados!');
        console.log('ğŸ”„ Recarregando em 1.5 segundos...');
       
        // Recarrega apÃ³s 1.5 segundos
        setTimeout(() => {
            location.reload();
        }, 1500);
    });
   
    // Adiciona ao body
    document.body.appendChild(debugBtn);
}
</script>

<!-- ========== ATALHO DE TECLADO ALTERNATIVO ========== -->
<script>
// Atalho: Ctrl+Shift+R = Limpar perfis vistos + limites
document.addEventListener('keydown', async (e) => {
    if (e.ctrlKey && e.shiftKey && e.key === 'R') {
        e.preventDefault();
       
        if (isTestUser()) {
            console.log('ğŸ”‘ Atalho ativado! Limpando TUDO...');
           
            // Limpa localStorage
            localStorage.removeItem('sparkSeenProfiles');
            localStorage.removeItem('sparkDailyLimits');
            localStorage.removeItem('sparkWeeklyLimits');
           
            // Reseta backend
            try {
                await fetch('https://mini-production-cf60.up.railway.app/api/debug/reset-limits-only');
                console.log('âœ… Backend resetado!');
            } catch (error) {
                console.warn('âš ï¸ Erro no backend:', error);
            }
           
            // Toast
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 left-1/2 -translate-x-1/2 bg-purple-500 text-white px-6 py-3 rounded-full shadow-lg z-[9999] text-sm font-bold';
            toast.textContent = 'âŒ¨ï¸ Atalho: TUDO limpo! Recarregando...';
            document.body.appendChild(toast);
           
            setTimeout(() => location.reload(), 1500);
        } else {
            console.log('âš ï¸ Atalho disponÃ­vel apenas para usuÃ¡rios de teste');
        }
    }
});
</script>

<!-- ========== CONSOLE HELPER ========== -->
<script>
// Adiciona funÃ§Ãµes globais de debug
if (isTestUser()) {
    // FunÃ§Ã£o para limpar tudo
    window.clearAllDebugData = async function() {
        console.log('ğŸ§¹ Limpando TODOS os dados de debug...');
       
        // Limpa localStorage
        localStorage.removeItem('sparkSeenProfiles');
        localStorage.removeItem('sparkDailyLimits');
        localStorage.removeItem('sparkWeeklyLimits');
        localStorage.removeItem('sparkUserPlan');
        localStorage.removeItem('sparkConversations');
       
        // Reseta backend
        try {
            const response = await fetch('https://mini-production-cf60.up.railway.app/api/debug/reset-limits-only');
            if (response.ok) {
                console.log('âœ… Backend resetado!');
            }
        } catch (error) {
            console.warn('âš ï¸ Erro ao resetar backend:', error);
        }
       
        console.log('âœ… Tudo limpo!');
        console.log('ğŸ”„ Recarregando em 2 segundos...');
       
        setTimeout(() => location.reload(), 2000);
    };
   
    // FunÃ§Ã£o para ver o que estÃ¡ salvo
    window.showDebugData = function() {
        console.log('ğŸ“Š DADOS DE DEBUG:');
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        console.log('ğŸ‘ï¸ Perfis vistos:', localStorage.getItem('sparkSeenProfiles'));
        console.log('ğŸ’ Limites diÃ¡rios:', localStorage.getItem('sparkDailyLimits'));
        console.log('âš¡ Limites semanais:', localStorage.getItem('sparkWeeklyLimits'));
        console.log('ğŸ‘¤ Plano:', localStorage.getItem('sparkUserPlan'));
        console.log('ğŸ’¬ Conversas:', localStorage.getItem('sparkConversations'));
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    };
   
    console.log('');
    console.log('ğŸ§ª â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('ğŸ§ª MODO DEBUG ATIVADO PARA USUÃRIOS DE TESTE');
    console.log('ğŸ§ª â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('');
    console.log('ğŸ“Œ FUNÃ‡Ã•ES DISPONÃVEIS NO CONSOLE:');
    console.log(' clearSeenProfiles() - Limpa perfis vistos');
    console.log(' clearAllDebugData() - Limpa TUDO');
    console.log(' showDebugData() - Mostra dados salvos');
    console.log(' getVIPStats() - Ver status VIP');
    console.log('');
    console.log('ğŸ”˜ BOTÃƒO: Clique no botÃ£o ğŸ”„ no canto inferior esquerdo');
    console.log('âŒ¨ï¸ ATALHO: Ctrl+Shift+R para limpar perfis');
    console.log('');
}
</script>
</body>
</html>
