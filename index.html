<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spark Mini App - Premium Match</title>
 
  <!-- Telegram Web App -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
 
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
 
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
 
  <!-- CSS Customizado -->
  <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="w-full max-w-[370px] p-4">
        <div class="glass-card p-4 relative">
            <!-- Header -->
            <div class="flex justify-between items-center mb-4 px-2">
                <div class="flex items-center gap-2 font-black text-2xl text-gray-800 tracking-tighter">
                    <i class="fa-solid fa-fire-flame-curved text-orange-500"></i> SPARK
                </div>
                <button class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 text-gray-500">
                    <i class="fa-solid fa-sliders"></i>
                </button>
            </div>
            <!-- Profile Card (vis√≠vel quando tem perfis) -->
            <div id="profile-card-area">
                <div class="relative">
                    <img id="profile-image" src="" class="profile-img mb-4" alt="Perfil">
                    <div id="verified-badge" class="absolute top-4 left-4 bg-white/90 backdrop-blur-md px-3 py-1 rounded-full flex items-center gap-1">
                        <i class="fa-solid fa-circle-check text-blue-500 text-xs"></i>
                        <span class="text-[10px] font-bold text-gray-700 uppercase">Verificado</span>
                    </div>
                </div>
                <!-- Profile Info -->
                <div class="px-2 mb-6 text-center">
                    <h2 id="profile-name" class="text-2xl font-extrabold text-gray-900">Carregando...</h2>
                    <p id="profile-bio" class="text-gray-500 text-sm mt-1"></p>
                </div>
                <!-- Action Buttons -->
                <div id="action-buttons" class="flex justify-center items-center gap-4 px-2 pb-2">
                    <button id="btn-star" class="btn-action bg-blue-100 text-blue-500">
                        <i class="fa-solid fa-star text-lg"></i>
                    </button>
                    <button id="btn-dislike" class="btn-action bg-white text-red-500 border border-red-50 text-2xl">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                    <button id="btn-like" class="btn-action bg-gradient-to-br from-green-400 to-emerald-500 text-white text-2xl">
                        <i class="fa-solid fa-heart"></i>
                    </button>
                    <div class="relative">
                        <button id="btn-boost" class="btn-action bg-gradient-to-tr from-purple-600 to-indigo-600 text-white">
                            <i class="fa-solid fa-bolt-lightning text-lg"></i>
                        </button>
                        <span class="absolute -bottom-5 left-1/2 -translate-x-1/2 text-[8px] font-black text-purple-600 uppercase whitespace-nowrap">Boost 1h</span>
                    </div>
                </div>
            </div>
            <!-- Tela de Sem Perfis (escondida por padr√£o) -->
            <div id="no-profiles-area" class="hidden">
                <div class="text-center py-8">
                    <div class="w-32 h-32 mx-auto mb-6 bg-gradient-to-br from-orange-100 to-pink-100 rounded-full flex items-center justify-center animate-pulse">
                        <i class="fa-solid fa-heart-crack text-5xl text-orange-400"></i>
                    </div>
                    <h2 class="text-2xl font-extrabold text-gray-800 mb-2">Por enquanto √© s√≥! üí´</h2>
                    <p class="text-gray-500 text-sm mb-6 px-4">
                        N√£o h√° mais perfis na sua regi√£o.<br>Volte mais tarde para conhecer novas pessoas!
                    </p>
                    <div class="flex flex-col gap-3 px-4">
                        <button onclick="location.reload()" class="w-full bg-gradient-to-r from-orange-500 to-pink-500 text-white font-bold py-3 rounded-2xl shadow-lg hover:shadow-xl transition-all">
                            <i class="fa-solid fa-arrows-rotate mr-2"></i> Atualizar
                        </button>
                        <a href="likes.html" class="w-full bg-gray-100 text-gray-700 font-bold py-3 rounded-2xl text-center hover:bg-gray-200 transition-all">
                            <i class="fa-solid fa-star mr-2 text-orange-500"></i> Ver quem curtiu voc√™
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Bottom Navigation -->
        <div class="flex justify-around items-center mt-8 bg-white/80 backdrop-blur-xl p-3 rounded-3xl shadow-lg border border-white">
            <a href="index.html" class="flex flex-col items-center text-orange-500">
                <i class="fa-solid fa-layer-group text-xl"></i>
                <span class="text-[9px] font-bold mt-1 uppercase">Explorar</span>
            </a>
            <a href="likes.html" class="flex flex-col items-center text-gray-400 relative">
                <i class="fa-solid fa-star text-xl"></i>
                <span id="likes-badge" class="hidden absolute -top-1 -right-2 bg-pink-500 text-white text-[9px] font-bold w-4 h-4 flex items-center justify-center rounded-full border-2 border-white">0</span>
                <span class="text-[9px] font-bold mt-1 uppercase">Likes</span>
            </a>
            <a href="chat.html" class="flex flex-col items-center text-gray-400">
                <i class="fa-solid fa-comment-dots text-xl"></i>
                <span class="text-[9px] font-bold mt-1 uppercase">Chat</span>
            </a>
            <a href="perfil.html" class="flex flex-col items-center text-gray-400">
                <i class="fa-solid fa-circle-user text-xl"></i>
                <span class="text-[9px] font-bold mt-1 uppercase">Perfil</span>
            </a>
        </div>
    </div>

    <!-- üî• SCRIPT DE DETEC√á√ÉO DE ID - DEVE VIR ANTES DOS OUTROS -->
    <script>
    // ========== SISTEMA DE DETEC√á√ÉO DE TELEGRAM ID ==========
    (function() {
        const testUsers = [1293602874, 8542013089];
        
        // Tenta pegar o ID do Telegram
        let telegramId = null;
        
        if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe?.user?.id) {
            telegramId = window.Telegram.WebApp.initDataUnsafe.user.id;
            console.log('‚úÖ Telegram ID detectado:', telegramId);
        }
        
        // Se n√£o conseguiu, tenta do localStorage
        if (!telegramId) {
            telegramId = localStorage.getItem('testTelegramId');
            if (telegramId) {
                console.log('‚úÖ Telegram ID do localStorage:', telegramId);
            }
        }
        
        // üî• SE AINDA N√ÉO TEM ID, PEDE PRO USU√ÅRIO (S√ì NA PRIMEIRA VEZ)
        if (!telegramId) {
            console.log('‚ö†Ô∏è Telegram ID n√£o detectado! Pedindo ao usu√°rio...');
            
            // Mostra modal para inserir ID
            setTimeout(() => {
                const modal = document.createElement('div');
                modal.id = 'id-modal';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 999999;
                    padding: 20px;
                `;
                modal.innerHTML = `
                    <div style="background: white; border-radius: 20px; padding: 24px; max-width: 320px; width: 100%; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üîê</div>
                        <h2 style="font-size: 20px; font-weight: 800; color: #1f2937; margin-bottom: 8px;">Identifica√ß√£o</h2>
                        <p style="color: #6b7280; font-size: 14px; margin-bottom: 20px;">
                            N√£o conseguimos detectar seu ID automaticamente.<br>
                            Por favor, insira seu Telegram ID:
                        </p>
                        <input 
                            type="text" 
                            id="telegram-id-input"
                            placeholder="Ex: 8542013089"
                            style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; text-align: center; margin-bottom: 16px; outline: none;"
                        >
                        <button 
                            id="save-id-btn"
                            style="width: 100%; background: linear-gradient(to right, #f97316, #ec4899); color: white; font-weight: 700; padding: 14px; border-radius: 12px; border: none; cursor: pointer; font-size: 16px;"
                        >
                            Confirmar
                        </button>
                        <p style="color: #9ca3af; font-size: 11px; margin-top: 12px;">
                            üí° Envie /start para @userinfobot no Telegram para descobrir seu ID
                        </p>
                    </div>
                `;
                document.body.appendChild(modal);
                
                // Foca no input
                document.getElementById('telegram-id-input').focus();
                
                // Bot√£o de salvar
                document.getElementById('save-id-btn').addEventListener('click', () => {
                    const inputId = document.getElementById('telegram-id-input').value.trim();
                    
                    if (inputId && /^\d+$/.test(inputId)) {
                        localStorage.setItem('testTelegramId', inputId);
                        console.log('‚úÖ Telegram ID salvo:', inputId);
                        modal.remove();
                        location.reload(); // Recarrega pra aplicar
                    } else {
                        alert('Por favor, insira um ID v√°lido (apenas n√∫meros)');
                    }
                });
                
                // Enter para confirmar
                document.getElementById('telegram-id-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('save-id-btn').click();
                    }
                });
            }, 500);
        }
        
        // Salva globalmente para outros scripts usarem
        window.SPARK_TELEGRAM_ID = telegramId;
        
        // Define se √© usu√°rio de teste
        window.IS_TEST_USER = testUsers.includes(parseInt(telegramId));
        
        console.log('üì± SPARK_TELEGRAM_ID:', window.SPARK_TELEGRAM_ID);
        console.log('üß™ IS_TEST_USER:', window.IS_TEST_USER);
    })();
    </script>

    <!-- ‚ö° ORDEM IMPORTANTE DOS SCRIPTS! -->
    <script src="profiles.js"></script>
    <script src="config.js"></script>
    <script src="vip.js"></script>
    <script src="match.js"></script>
    <script src="app.js"></script>

<!-- ========== BOT√ÉO SECRETO DE DEBUG - S√ì PARA USU√ÅRIOS DE TESTE ========== -->
<script>
// Usa a vari√°vel global definida acima
function isTestUser() {
    return window.IS_TEST_USER === true;
}

// S√≥ mostra o bot√£o se for usu√°rio de teste
if (isTestUser()) {
    console.log('üß™ Usu√°rio de teste detectado! Bot√£o de debug ativado.');
   
    // Cria o bot√£o
    const debugBtn = document.createElement('button');
    debugBtn.innerHTML = 'üîÑ';
    debugBtn.title = 'Limpar perfis vistos (s√≥ para teste)';
    debugBtn.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: 3px solid white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        font-size: 24px;
        cursor: pointer;
        z-index: 9999;
        opacity: 0.7;
        transition: all 0.3s ease;
    `;
   
    // Hover effect
    debugBtn.addEventListener('mouseenter', () => {
        debugBtn.style.opacity = '1';
        debugBtn.style.transform = 'scale(1.1)';
    });
   
    debugBtn.addEventListener('mouseleave', () => {
        debugBtn.style.opacity = '0.7';
        debugBtn.style.transform = 'scale(1)';
    });
   
    // Fun√ß√£o para resetar likes via API
    async function resetLikesBetweenTests() {
        console.log('üßπ Resetando likes entre usu√°rios de teste via API...');
        
        try {
            const telegramId1 = '1293602874';
            const telegramId2 = '8542013089';
            const adminSecret = 'minha_chave_super_secreta_admin_2024';

            const response = await fetch('https://mini-production-cf60.up.railway.app/api/admin/reset-likes-between-users', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    secret: adminSecret,
                    telegram_id1: telegramId1,
                    telegram_id2: telegramId2
                })
            });

            if (!response.ok) throw new Error('Erro na API');
            const data = await response.json();
            console.log('‚úÖ Likes resetados:', data);

            // Toast de sucesso
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 left-1/2 -translate-x-1/2 bg-blue-500 text-white px-6 py-3 rounded-full shadow-lg z-[9999] text-sm font-bold';
            toast.textContent = '‚úÖ Likes m√∫tuos resetados no banco!';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        } catch (error) {
            console.error('‚ùå Erro ao resetar likes:', error);
        }
    }
   
    // Fun√ß√£o de limpar
    debugBtn.addEventListener('click', async () => {
        console.log('üßπ Limpando TUDO (perfis vistos + limites + likes)...');
       
        // 1. Limpa perfis vistos do FRONTEND
        localStorage.removeItem('sparkSeenProfiles');
        console.log('‚úÖ Perfis vistos limpos do localStorage');
       
        // 2. Limpa limites VIP do FRONTEND
        localStorage.removeItem('sparkDailyLimits');
        localStorage.removeItem('sparkWeeklyLimits');
        console.log('‚úÖ Limites VIP limpos do localStorage');
       
        // 3. RESETA LIMITES NO BACKEND
        try {
            const response = await fetch('https://mini-production-cf60.up.railway.app/api/debug/reset-limits-only');
            if (response.ok) {
                const data = await response.json();
                console.log('‚úÖ Limites resetados no backend:', data);
            }
        } catch (error) {
            console.warn('‚ö†Ô∏è Erro ao resetar backend (continuando mesmo assim):', error);
        }
       
        // 4. RESETA LIKES M√öTUOS NO BANCO VIA API
        await resetLikesBetweenTests();
       
        // Anima√ß√£o de sucesso
        debugBtn.innerHTML = '‚úÖ';
        debugBtn.style.background = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
       
        // 5. Mensagem de sucesso
        const toast = document.createElement('div');
        toast.className = 'fixed top-4 left-1/2 -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-full shadow-lg z-[60] text-sm font-bold';
        toast.textContent = '‚úÖ TUDO limpo! Perfis + Limites + Likes resetados!';
        document.body.appendChild(toast);
       
        console.log('‚úÖ Perfis vistos limpos!');
        console.log('‚úÖ Limites resetados!');
        console.log('‚úÖ Likes resetados!');
        console.log('üîÑ Recarregando em 1.5 segundos...');
       
        // Recarrega ap√≥s 1.5 segundos
        setTimeout(() => {
            location.reload();
        }, 1500);
    });
   
    // Adiciona ao body
    document.body.appendChild(debugBtn);
} else {
    console.log('‚ùå Usu√°rio N√ÉO √© de teste, bot√£o de debug n√£o ser√° mostrado');
}
</script>

<!-- ========== CONSOLE HELPER ========== -->
<script>
// Fun√ß√µes globais de debug
window.clearAllDebugData = async function() {
    console.log('üßπ Limpando TODOS os dados...');
   
    localStorage.removeItem('sparkSeenProfiles');
    localStorage.removeItem('sparkDailyLimits');
    localStorage.removeItem('sparkWeeklyLimits');
    localStorage.removeItem('sparkUserPlan');
    localStorage.removeItem('sparkConversations');
    localStorage.removeItem('testTelegramId');
   
    try {
        await fetch('https://mini-production-cf60.up.railway.app/api/debug/reset-limits-only');
        console.log('‚úÖ Backend resetado!');
    } catch (error) {
        console.warn('‚ö†Ô∏è Erro:', error);
    }
   
    console.log('‚úÖ Tudo limpo! Recarregando...');
    setTimeout(() => location.reload(), 1000);
};

window.showMyId = function() {
    const id = window.SPARK_TELEGRAM_ID || localStorage.getItem('testTelegramId');
    console.log('üÜî Seu Telegram ID:', id);
    alert('Seu Telegram ID: ' + id);
    return id;
};

window.setMyId = function(id) {
    localStorage.setItem('testTelegramId', id);
    console.log('‚úÖ ID salvo:', id);
    location.reload();
};

console.log('');
console.log('üí° COMANDOS √öTEIS:');
console.log(' showMyId() - Ver seu ID');
console.log(' setMyId("123") - Definir ID manualmente');
console.log(' clearAllDebugData() - Limpar tudo');
console.log('');
</script>
</body>
</html>
